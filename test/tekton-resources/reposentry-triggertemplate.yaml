# RepoSentry 专用的 TriggerTemplate
apiVersion: triggers.tekton.dev/v1beta1
kind: TriggerTemplate
metadata:
  name: reposentry-trigger-template
  namespace: tekton-pipelines
spec:
  params:
    - name: repo-name
      description: "仓库名称"
      default: "unknown-repo"
    - name: repo-url
      description: "仓库 URL"
      default: ""
    - name: branch
      description: "分支名称"
      default: "refs/heads/main"
    - name: commit-sha
      description: "提交 SHA"
      default: ""
    - name: event-type
      description: "事件类型"
      default: "push"
    - name: provider
      description: "Git 提供商"
      default: "github"
    - name: reposentry-event-id
      description: "RepoSentry 事件 ID"
      default: ""
    - name: reposentry-timestamp
      description: "RepoSentry 时间戳"
      default: ""
  resourcetemplates:
    - apiVersion: tekton.dev/v1
      kind: PipelineRun
      metadata:
        generateName: reposentry-test-run-
        namespace: tekton-pipelines
        labels:
          reposentry.test/provider: $(tt.params.provider)
          reposentry.test/repo: $(tt.params.repo-name)
          reposentry.test/event-id: $(tt.params.reposentry-event-id)
      spec:
        serviceAccountName: reposentry-test-sa
        pipelineRef:
          name: reposentry-test-pipeline
        params:
          - name: repo-name
            value: $(tt.params.repo-name)
          - name: repo-url
            value: $(tt.params.repo-url)
          - name: branch
            value: $(tt.params.branch)
          - name: commit-sha
            value: $(tt.params.commit-sha)
          - name: event-type
            value: $(tt.params.event-type)
          - name: provider
            value: $(tt.params.provider)
          - name: reposentry-event-id
            value: $(tt.params.reposentry-event-id)
          - name: reposentry-timestamp
            value: $(tt.params.reposentry-timestamp)
