# Generated by RepoSentry
# File: 01-pipeline.yaml
---
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: reposentry-bootstrap-pipeline
  namespace: reposentry-system
  labels:
    reposentry.io/component: "bootstrap"
    reposentry.io/type: "pipeline"
  annotations:
    reposentry.io/generated-at: "2025-08-27T02:46:05Z"
    reposentry.io/description: "Static Bootstrap Pipeline for processing user Tekton resources"
spec:
  description: "Bootstrap Pipeline to clone, validate, and apply user Tekton resources from remote repositories"
  params:
  - name: repo-url
    type: string
    description: "URL of the user repository to process"
  - name: repo-branch
    type: string
    description: "Branch name to checkout"
    default: "main"
  - name: commit-sha
    type: string
    description: "Commit SHA to checkout"
  - name: repo-full-name
    type: string
    description: "Repository full name (org/repo) for computing target namespace"
  - name: tekton-path
    type: string
    description: "Path to Tekton resources in the repository"
    default: ".tekton"
  workspaces:
  - name: source-workspace
    description: "Workspace for cloned source code and processed resources"
  tasks:
  - name: clone-user-repository
    taskRef:
      name: reposentry-bootstrap-clone
    params:
    - name: repo-url
      value: $(params.repo-url)
    - name: repo-branch
      value: $(params.repo-branch)
    - name: commit-sha
      value: $(params.commit-sha)
    workspaces:
    - name: source
      workspace: source-workspace
  - name: compute-target-namespace
    taskRef:
      name: reposentry-bootstrap-compute-namespace
    runAfter:
    - clone-user-repository
    params:
    - name: repo-url
      value: $(params.repo-url)
    - name: repo-full-name
      value: $(params.repo-full-name)
  - name: validate-tekton-resources
    taskRef:
      name: reposentry-bootstrap-validate
    runAfter:
    - clone-user-repository
    - compute-target-namespace
    params:
    - name: tekton-path
      value: $(params.tekton-path)
    - name: target-namespace
      value: $(tasks.compute-target-namespace.results.namespace-name)
    workspaces:
    - name: source
      workspace: source-workspace
  - name: ensure-user-namespace
    taskRef:
      name: reposentry-bootstrap-ensure-namespace
    runAfter:
    - validate-tekton-resources
    params:
    - name: target-namespace
      value: $(tasks.compute-target-namespace.results.namespace-name)
    - name: repo-url
      value: $(params.repo-url)
  - name: apply-user-resources
    taskRef:
      name: reposentry-bootstrap-apply
    runAfter:
    - clone-user-repository
    - ensure-user-namespace
    params:
    - name: target-namespace
      value: $(tasks.compute-target-namespace.results.namespace-name)
    workspaces:
    - name: resources
      workspace: source-workspace
  - name: run-user-pipeline
    taskRef:
      name: reposentry-bootstrap-run
    runAfter:
    - apply-user-resources
    params:
    - name: target-namespace
      value: $(tasks.compute-target-namespace.results.namespace-name)
    - name: pipeline-name
      value: $(tasks.apply-user-resources.results.pipeline-name)
    - name: repo-url
      value: $(params.repo-url)
    - name: repo-branch
      value: $(params.repo-branch)
    - name: commit-sha
      value: $(params.commit-sha)
    - name: repo-full-name
      value: $(params.repo-full-name)
---